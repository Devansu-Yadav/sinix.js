<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: bin/sinix.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: bin/sinix.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>#!/usr/bin/env node

/**
 * Loading the 'fs', 'path', 'tmp', 'archiver' node modules 
 */
const fs = require("fs")
const path = require("path")
const tmp = require("tmp")
const archiver = require("archiver")
/**
 * Loading the version of 'sinix' from 'package.json'
 */
const { version } = require("../package.json")
/**
 * Storing arguments passed to 'process' in an array.
 * @type {Array}
 */
const [,, ... args] = process.argv
const CONF_PATH = path.join(process.cwd(), "sinix.config.js")
const PACK_PATH = path.join(process.cwd(), "package.json")

console.log(`sinix.js v${version}`)
/**
 * @returns {void}
 */
const pack = () => {
  /**
   * Initialize a Node project if path to 'package.json' does not exist 
   */
  if (!fs.existsSync(PACK_PATH)){
    console.log("Not a Node project.")
    console.log(`
  $ npm init
`)
  }
  /**
   * Check if a Sinix project is initialized or not 
   */
  if (!fs.existsSync(CONF_PATH)){
    console.log("Not a Sinix application.")
    console.log(`
  $ sinix init # to initialize
`)
    return
  }

  const config = require(CONF_PATH)

  /**
   * Create 'release' directory if the path does not exist
   */
  if (!fs.existsSync("release")){
    fs.mkdirSync("release")
  }
  /**
   * @returns {void} 
   */
  tmp.file((err, tmp_path) => {
    if (err) throw err
    /**
     * @description Creating a Writestream object
     */
    const output = fs.createWriteStream(tmp_path)
    const archive = archiver("zip")
    /**
     * @description Returns the "total bytes" after running $sinix pack command in project.
     */
    output.on("close", () => {
      console.log(archive.pointer() + " total bytes")
      const name = sinixJsonObj.slug.replace(" ", "-")

      fs.copyFile(tmp_path, `release/${name}.dext`, function(err){
        if(err){
          console.log(err)
        }
      })
    })

    output.on("end", () => {
      console.log("Data has been drained")
    })

    archive.on("warning", (err) => {
      if(err.code === "ENOENT"){
        console.log(err)
      } else {
        throw err
      }
    })

    archive.on("error", (err) => {
      console.log(err)
    })

    archive.pipe(output)
    /**
     * @description Check if 'distDir' exists in 'sinix.config.js' file
     */
    if (!fs.existsSync(config.distDir)){
      console.log(`${config.distDir} does not exists`)
      return
    }
    /**
     * @description Parsing package.json into a Javascript object
     * @type {Object}
     */
    const packageJsonObj = JSON.parse(fs.readFileSync("package.json"))
    /**
     * @description Storing package.json values
     * @type {{name: string, version: string, title: string, slug: string}}
     */
    const sinixJsonObj = {
      name: packageJsonObj.name,
      version: packageJsonObj.version,
      title: config.title ? config.title : packageJsonObj.name,
      slug: `${packageJsonObj.name}-v${packageJsonObj.version}`
    }
    const sinixJson = JSON.stringify(sinixJsonObj, null, 2)

    process.chdir(config.distDir)

    fs.writeFileSync("sinix.manifest.json", sinixJson)

    archive.glob("**", {
      ignore: ["node_modules/**", "release/**"]
    })

    process.chdir("../")

    archive.finalize()
  })
}
/**
 * @description Initializing 'distDir' value for 'sinix.config.js' 
 */
const init = () => {
  const configObj = {
    "distDir": "dist/"
  }

  const config = JSON.stringify(configObj, null, 2)
  const code = `module.exports = ${config}`
  /**
   * @description Write data in 'sinix.config.js' while initializing a Sinix project
   */
  fs.writeFile("sinix.config.js", code, (err) => {
    if(err){
      console.log(err)
    } else {
      console.log("Initialized Sinix project")
    }
  })
}
/**
 * @description Perform 'pack' or 'init' function according to command on CLI.
 */
switch(args[0]){
case "pack": pack(); break
case "init": init(); break
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#axios">axios</a></li><li><a href="global.html#connect">connect</a></li><li><a href="global.html#contains">contains</a></li><li><a href="global.html#create">create</a></li><li><a href="global.html#db">db</a></li><li><a href="global.html#dump">dump</a></li><li><a href="global.html#EVENT_OBJ">EVENT_OBJ</a></li><li><a href="global.html#fs">fs</a></li><li><a href="global.html#init">init</a></li><li><a href="global.html#listen">listen</a></li><li><a href="global.html#load">load</a></li><li><a href="global.html#pack">pack</a></li><li><a href="global.html#poll">poll</a></li><li><a href="global.html#query">query</a></li><li><a href="global.html#read">read</a></li><li><a href="global.html#register">register</a></li><li><a href="global.html#remove_item">remove_item</a></li><li><a href="global.html#update_item">update_item</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.6</a> on Mon Nov 23 2020 01:54:46 GMT-0500 (Eastern Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
